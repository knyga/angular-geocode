/*! angular-geocode - v1.0.0 - 2015-04-28
* https://github.com/knyga/angular-geocode
* Copyright (c) 2015 ; Licensed  */
angular.module("angularGeocode",[]),angular.module("angularGeocode").service("GeoFunctions",[function(){var a=this;this.calculateLatLngBoundsSquare=function(a){if("undefined"==typeof a)return 0;var b={x:a.getNorthEast().lat(),y:a.getNorthEast().lng()},c={x:a.getSouthWest().lat(),y:a.getSouthWest().lng()};return(b.x-c.x)*(b.y-c.y)},this.convertToLatLngBounds=function(a){return new google.maps.LatLngBounds(new google.maps.LatLng(a.sw.latitude,a.sw.longitude),new google.maps.LatLng(a.ne.latitude,a.ne.longitude))},this.calculateZoomLevel=function(b,c){function d(a,b,c){return Math.floor(Math.log(a/b/c)/Math.LN2)}var e=16,f={height:256,width:256},g=(a.convertLatitudeToRadians(b.ne.latitude)-a.convertLatitudeToRadians(b.sw.latitude))/Math.PI,h=b.ne.longitude-b.sw.longitude,i=(0>h?h+360:h)/360,j=d(c.height,f.height,g),k=d(c.width,f.width,i);return Math.min(j,k,e)},this.calculateCircleBounds=function(b,c){var d=a.convertDistanceToLatitude(c),e=a.convertDistanceToLongitude(c),f={sw:{latitude:b.latitude-d,longitude:b.longitude-e},ne:{latitude:b.latitude+d,longitude:b.longitude+e}};return f},this.convertDegToRadians=function(a){return Math.PI*a/180},this.convertLongitudeToRadians=this.convertLatitudeToRadians=function(a){var b=Math.sin(a*Math.PI/180),c=Math.log((1+b)/(1-b))/2;return Math.max(Math.min(c,Math.PI),-Math.PI)/2},this.convertDistanceToLatitude=function(a){var b=6378137,c=Math.sqrt(b*b*2)/90;return a/c},this.convertDistanceToLongitude=function(a){var b=6378177,c=Math.sqrt(b*b*2)/90;return a/c},this.calculateDistanceBetweenPoints=function(b,c){var d=6378137,e=a.convertDegToRadians(c.lat-b.lat),f=a.convertDegToRadians(c.lng-c.lng),g=Math.sin(e/2)*Math.sin(e/2)+Math.cos(a.convertDegToRadians(b.lat)*a.convertDegToRadians(c.lat))*Math.sin(f/2)*Math.sin(f/2),h=2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g)),i=d*h;return i}}]),angular.module("angularGeocode").factory("geocodef",["$timeout","$q",function(a,b){var c=function(){return"undefined"!=typeof google?!0:!1},d=function(){return c()?new google.maps.Geocoder:null},e=function(a){if("undefined"==typeof a)return 0;var b={x:a.getNorthEast().lat(),y:a.getNorthEast().lng()},c={x:a.getSouthWest().lat(),y:a.getSouthWest().lng()};return(b.x-c.x)*(b.y-c.y)},f=d(),g=function(b,e,g){var h=100,i=-1;i=setInterval(function(){c()&&clearInterval(i),null==f&&(f=d()),f.geocode(b,function(b,c){a(function(){if(!e(b,c))switch(c){case google.maps.GeocoderStatus.OVER_QUERY_LIMIT:g.reject("Over query limit");break;case google.maps.GeocoderStatus.REQUEST_DENIED:g.reject("Request denied");break;case google.maps.GeocoderStatus.INVALID_REQUEST:g.reject("Invalid request")}})})},h)};return{toLatLng:function(a){var c=b.defer(),d=function(b,d){var e={latLng:{latitude:0,longitude:0},address:a.address,result:b};switch(d){case"OK":return e.latLng={latitude:b[0].geometry.location.lat(),longitude:b[0].geometry.location.lng()},c.resolve(e),!0;case"ZERO_RESULTS":return c.resolve(e),!0}return!1};return a.address?g({address:a.address},d,c):d(null,"ZERO_RESULTS"),c.promise},toAddress:function(a){var c=b.defer(),d=function(b,d){switch(d){case"OK":var f=b.length?b[b.length-1].formatted_address:"",g=b[b.length-1],h=0,i=0,j=0;for(j=b.length-1;j>=0;j--)if(b[j].hasOwnProperty("geometry")&&/(locality|administrative_area_level|country)/.test(b[j].types[0])&&(g=b[j],a.bounds)){if(h=e(a.bounds),i=e(b[j].geometry.bounds),h>i){a.isTakeBigger&&(j<b.length-1&&j++,g=b[j]);break}g=b[j]}if(f=g.formatted_address)return c.resolve({address:f,latLng:a.latLng,result:b}),!0;c.reject("Location not found");break;case"ZERO_RESULTS":return c.reject("No results"),!0}return!1};return a.latLng&&a.latLng.latitude&&a.latLng.longitude?g({latLng:{lat:a.latLng.latitude,lng:a.latLng.longitude}},d,c):d(null,"ZERO_RESULTS"),c.promise}}}]),angular.module("angularGeocode").directive("geocode",["$timeout","geocodef",function(a,b){return{restrict:"EA",scope:{address:"=?",coordinates:"=?",result:"=?",bounds:"=?",changedManually:"=?"},template:"<div></div>",link:function(a,c,d){var e={address:!1,coordinates:!0},f=d.hasOwnProperty("blockManualReverse"),g=d.hasOwnProperty("reverseBinding");"undefined"==typeof a.changedManually&&(a.changedManually=d.hasOwnProperty("changedManually")),c.on("change keydown",function(){a.changedManually=!0}),a.$watch("address",function(c,d){d&&0<d.length&&0===c.length&&(a.changedManually=!1),!e.address&&c&&c.length>0&&a.changedManually&&b.toLatLng({address:c,bounds:a.bounds}).then(function(b){a.coordinates=b.latLng,a.result=b.result,e.coordinates=!0}),e.address=!1}),a.$watch("coordinates",function(c){e.coordinates||!g||a.changedManually&&f||b.toAddress({latLng:c,bounds:a.bounds}).then(function(b){a.address=b.address,a.result=b.result,e.address=!0,a.changedManually=!1}),e.coordinates=!1},!0)}}}]);