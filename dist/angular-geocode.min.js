/*! angular-geocode - v1.0.0 - 2015-04-24
* https://github.com/knyga/angular-geocode
* Copyright (c) 2015 ; Licensed  */
angular.module("angularGeocode",[]),angular.module("angularGeocode").directive("geocode",["$timeout","geocodef",function(a,b){return{restrict:"EA",scope:{address:"=?",coordinates:"=?",result:"=?",bounds:"=?"},template:"<div></div>",link:function(a,c,d){var e={address:!1,coordinates:!0},f=!1,g=d.hasOwnProperty("blockManualReverse")?!0:!1;c.on("change keydown",function(){f=!0}),a.$watch("address",function(c,d){d&&0<d.length&&0===c.length&&(f=!1),e.address||b.toLatLng({address:c,bounds:a.bounds}).then(function(b){a.coordinates=b.latLng,a.result=b.result,e.coordinates=!0}),e.address=!1}),a.$watch("coordinates",function(c){e.coordinates||f&&g||b.toAddress({latLng:c,bounds:a.bounds}).then(function(b){a.address=b.address,a.result=b.result,e.address=!0,f=!1}),e.coordinates=!1},!0)}}}]),angular.module("angularGeocode").factory("geocodef",["$timeout","$q",function(a,b){var c=function(){return"undefined"!=typeof google?new google.maps.Geocoder:null},d=function(a){var b={x:a.geometry.bounds.getNorthEast().lat(),y:a.geometry.bounds.getNorthEast().lng()},c={x:a.geometry.bounds.getSouthWest().lat(),y:a.geometry.bounds.getSouthWest().lng()};return(b.x-c.x)*(b.y-c.y)},e=function(a,b){var c={x:b.getNorthEast().lat(),y:b.getNorthEast().lng()},d={x:b.getSouthWest().lat(),y:b.getSouthWest().lng()},e={x:a.geometry.bounds.getNorthEast().lat(),y:a.geometry.bounds.getNorthEast().lng()},f={x:a.geometry.bounds.getSouthWest().lat(),y:a.geometry.bounds.getSouthWest().lng()};return c.x>e.x&&c.y>e.y&&d.x<f.x&&d.y<f.y},f=c(),g=function(b,d,e){null==f&&(f=c()),f.geocode(b,function(b,c){a(function(){if(!d(b,c))switch(c){case google.maps.GeocoderStatus.OVER_QUERY_LIMIT:e.reject("Over query limit");break;case google.maps.GeocoderStatus.REQUEST_DENIED:e.reject("Request denied");break;case google.maps.GeocoderStatus.INVALID_REQUEST:e.reject("Invalid request")}})})};return{toLatLng:function(a){var c=b.defer(),d=function(b,d){var e={latLng:{latitude:0,longitude:0},address:a.address,result:b};switch(d){case"OK":return e.latLng={latitude:b[0].geometry.location.lat(),longitude:b[0].geometry.location.lng()},c.resolve(e),!0;case"ZERO_RESULTS":return c.resolve(e),!0}return!1};return a.address?g({address:a.address},d,c):d(null,google.maps.GeocoderStatus.ZERO_RESULTS),c.promise},toAddress:function(a){var c=b.defer(),f=function(b,f){switch(f){case"OK":var g=b.length?b[b.length-1].formatted_address:"",h=[],i=null,j=0;for(j=0;j<b.length;j++)/(locality|administrative_area_level|country)/.test(b[j].types[0])&&b[j].hasOwnProperty("geometry")&&((!a.bounds||e(b[j],a.bounds))&&h.push(b[j]),i||(i=b[j]));if(h.length>0&&h.sort(function(a){return d(a)}),g=i.formatted_address)return c.resolve({address:g,latLng:a.latLng,result:b}),!0;c.reject("Location not found");break;case"ZERO_RESULTS":return c.reject("No results"),!0}return!1};return a.latLng&&a.latLng.latitude&&a.latLng.longitude?g({latLng:{lat:a.latLng.latitude,lng:a.latLng.longitude}},f,c):f(null,google.maps.GeocoderStatus.ZERO_RESULTS),c.promise}}}]);